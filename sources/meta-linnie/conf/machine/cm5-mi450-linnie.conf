# 2025 CM5 Systems
# @TYPE: Machine
# @NAME: cm5-mi450-linnie
# @DESCRIPTION: CM5 MI450 Linnie Machine Configuration
#
# This machine inherits from raspberrypi5.conf (found in meta-raspberrypi layer).
# BitBake's require searches all layer directories - no relative paths needed.
#
# Carrier board peripherals:
#   - 6x TMP100 temperature sensors on I2C1 (0x48, 0x49, 0x4A, 0x4C, 0x4D, 0x4E)
#   - USB 3.0 ports for camera ajd mouse
#   - HDMI output for display
#   - CSI connector (for future camera expansion)

# Base machine - Raspberry Pi CM5 (from meta-raspberrypi)
require conf/machine/raspberrypi5.conf

# CRITICAL: Tell kernel build system to use raspberrypi5's kernel configuration
KMACHINE = "raspberrypi5"
KMACHINE:cm5-mi450-linnie = "raspberrypi5"

# Ensure proper machine override inheritance
MACHINEOVERRIDES =. "raspberrypi5:"

# USB camera support (Logitech C920x and other UVC cameras)
MACHINE_EXTRA_RRECOMMENDS += " \
    kernel-module-uvcvideo \
    kernel-module-videobuf2-v4l2 \
    kernel-module-videobuf2-vmalloc \
"

# I2C support for temperature sensors
MACHINE_FEATURES:append = " i2c"