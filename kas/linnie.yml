header:
  version: 14

machine: cm5-mi450-linnie
distro: poky

repos:
  poky:
    url: https://git.yoctoproject.org/poky
    path: /yocto/workspace/sources/poky
    commit: 353491479086e8d3f209d5cce0019a29e143b064
    layers:
      meta:
      meta-poky:
      meta-yocto-bsp:

  meta-openembedded:
    url: https://git.openembedded.org/meta-openembedded
    path: /yocto/workspace/sources/meta-openembedded
    commit: 2759d8870ea387b76c902070bed8a6649ff47b56
    layers:
      meta-oe:
      meta-python:
      meta-networking:
      meta-multimedia:

  meta-raspberrypi:
    url: https://git.yoctoproject.org/meta-raspberrypi
    path: /yocto/workspace/sources/meta-raspberrypi
    commit: 2c646d29912dcc873469a57b1c207e1549c5094d

  meta-linnie:
    path: /workspaces/linnie/sources/meta-linnie

  meta-linnie-drivers:
    path: /workspaces/linnie/sources/meta-linnie-drivers

  meta-linnie-app:
    path: /workspaces/linnie/sources/meta-linnie-app

env:
  DL_DIR: /yocto/downloads
  SSTATE_DIR: /yocto/sstate-cache

local_conf_header:
  standard: |
    CONF_VERSION = "2"

  parallelism: |
    BB_NUMBER_THREADS = "8"
    PARALLEL_MAKE = "-j 8"

  init: |
    INIT_MANAGER = "systemd"
    DISTRO_FEATURES:append = " systemd"
    VIRTUAL-RUNTIME_init_manager = "systemd"
    VIRTUAL-RUNTIME_initscripts = "systemd-compat-units"

  serial: |
    ENABLE_UART = "1"

  i2c: |
    ENABLE_I2C = "1"
    RPI_EXTRA_CONFIG:append = "dtparam=i2c1=on\n"

  usb: |
    RPI_EXTRA_CONFIG:append = "dtoverlay=dwc2,dr_mode=host\n"

  licensing: |
    LICENSE_FLAGS_ACCEPTED = "synaptics-killswitch"

  image-features: |
    EXTRA_IMAGE_FEATURES += "debug-tweaks ssh-server-dropbear"

    # Linnie application and thermal overlay
    IMAGE_INSTALL:append = " linnie thermal-overlay"

    # Python runtime for linnie services
    IMAGE_INSTALL:append = " python3 python3-modules"

    # USB camera driver
    IMAGE_INSTALL:append = " kernel-module-uvcvideo"

    # Debug tools (remove these for production image)
    IMAGE_INSTALL:append = " v4l-utils i2c-tools usbutils"

target: core-image-base
